# this creates the new image to build
type: apply
nodes:
  - node_one:
      create:
        options:
          keyname: dans_keys
          # EBS backed 32 bit oneiric in us-west-2
          image: ami-8226abb2
          region: us-west-2
          type: m1.small
          group: accessible
      install:
        git_repos:
          git://github.com/saz/puppet-ssh: /etc/puppet/modules/ssh
          git://github.com/puppetlabs/puppetlabs-rsync: /etc/puppet/modules/rsync
          git://github.com/saz/puppet-memcached: /etc/puppet/modules/memcached
          git://github.com/puppetlabs/puppetlabs-stdlib: /etc/puppet/modules/stdlib
          git://github.com/puppetlabs/puppet-apt: /etc/puppet/modules/apt
          git://github.com/puppetlabs/puppetlabs-swift: /etc/puppet/modules/swift
        manifest: /etc/puppet/modules/swift/examples/all.pp
        options:
          keyfile: ~/.ssh/dans_keys.pem
          login: ubuntu
      test:
        command: ruby /etc/puppet/modules/swift/ext/swift.rb
        options:
          keyfile: ~/.ssh/dans_keys.pem
          login: ubuntu
