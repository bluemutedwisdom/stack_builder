# this creates the new image to build
puppet_run_type: apply
nodes:
  - all:
      create:
        options:
          keyname: dans_keys
          # EBS backed 32 bit oneiric in us-west-2
          image: ami-e434b9d4
          region: us-west-2
          type: m1.small
          group: accessible
      install:
        install_puppet: false
        git_repos:
          git://github.com/puppetlabs/puppet-apt: /etc/puppet/modules/apt
          git://github.com/bodepd/puppetlabs-nova: /etc/puppet/modules/nova
          git://github.com/bodepd/puppetlabs-ruby: /etc/puppet/modules/ruby
          git://github.com/bodepd/puppetlabs-glance: /etc/puppet/modules/glance
          git://github.com/bodepd/puppetlabs-rabbitmq: /etc/puppet/modules/rabbitmq
          git://github.com/puppetlabs/puppetlabs-mysql: /etc/puppet/modules/mysql
          git://github.com/puppetlabs/puppetlabs-stdlib: /etc/puppet/modules/stdlib
        git_checkout:
          /etc/puppet/modules/nova: dev
          /etc/puppet/modules/glance: dev
          /etc/puppet/modules/rabbitmq: dev
        manifest: /etc/puppet/modules/nova/examples/site.pp
        options:
          keyfile: ~/.ssh/dans_keys.pem
          login: ubuntu
